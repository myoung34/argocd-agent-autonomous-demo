apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: argocd-agent

resources:
- ../../base/base-app/

patches:
- target:
    kind: ApplicationSet
    name: apps
  patch: |
    - op: replace
      path: /spec/generators/0/git/directories
      value:
        - path: principal/*
        - path: principal/argocd*
          exclude: true
    - op: replace
      path: /spec/template/spec/source/path
      value: "principal/{{ path.basename }}"
